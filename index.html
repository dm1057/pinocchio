<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Pinocchio by vic</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/vic/pinocchio">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Pinocchio</h1>
            <h2>Git based server provisioning.</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/vic/pinocchio/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/vic/pinocchio/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a name="pinocchio---a-git-puppet" class="anchor" href="#pinocchio---a-git-puppet"><span class="octicon octicon-link"></span></a><a href="http://github.com/vic/pinocchio">Pinocchio</a> - A git puppet.</h1>

<p>A minimalist tool for Git based server provisioning.</p>

<p><img src="https://gist.github.com/vic/3494d261c68cb3b591e6/raw/acdbcdeb06606ee8a833e992e135bec6db34ecac/pinocchio.jpg" alt="Pinocchio"></p>

<h3>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why?</h3>

<p>Server configuration and software provisioning should be damn simple.</p>

<p>There are lots of tools for helping you install and configure your
full software stack at your new and shiny cloud based slice. Just to name
a few, we have <a href="http://puppetlabs.com">Puppet</a>, <a href="http://docs.opscode.com/index.html">Chef</a>, and the <a href="http://www.capistranorb.com/">Capistrano</a> based <a href="https://github.com/sprinkle-tool/sprinkle">Sprinkle</a>.
All of them trying to solve the problem of automating software installation
and configuration on many servers. Basically you write a <em>recipe</em> file 
containing instructions on how to install or configure something, some of
these recipes require you to learn their respective mini/dsl language, 
some of them even require you to host those recipes on a service of their
own.
Sure these tools all have their own merit and can be useful when managing
lots of servers, but for me, they were sometimes just like too much complex
when I just wanted to provision a new slice to get more fun at coding a 
new experiment.</p>

<p>I just wanted to have some dead simple way of uploading a new configuration
file or instructions for the server on how to install something. I wanted to
deliver these just like I'm used with regular code, by using git. 
I wanted to push and see <em>only</em> the new pending instructions being executed
on my remote slices. I wanted to have all of it versioned and under control.
I wanted these changes to be incremental, something like using rails database
migrations but for provisioning my servers.</p>

<p>So <a href="http://github.com/vic/pinocchio">Pinocchio</a> was born.</p>

<h3>
<a name="how-it-works" class="anchor" href="#how-it-works"><span class="octicon octicon-link"></span></a>How it works</h3>

<p><a href="http://github.com/vic/pinocchio">Pinocchio</a> is just a simple git <code>update</code> hook. It works by determining which
changes it needs to execute since the last successful update. 
It does it by leveraging on git to know which <em>migrations</em> need to be run, and only when <em><em>all</em></em> of these pending migrations have a successful exit status the git repo is updated.</p>

<h3>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h3>

<p><a href="http://github.com/vic/pinocchio">Pinocchio</a> is just a simple git update hook, all it needs is that
you place the contents of <code>hooks/pinocchio</code> on your remote
repo under <code>hooks/update</code> and make it executable and you're set. </p>

<p>However as you might want to avoid doing things by hand, we provide a simple
helper script <code>bin/pinocchio</code>, you can download to your workstation and 
just make it executable.</p>

<pre lang="shell"><code>curl http://raw.github.com/vic/pinocchio/master/bin/pinocchio &gt; /usr/local/bin/pinocchio
chmod 755 /usr/local/bin/pinocchio
</code></pre>

<p>In the following examples we assume the remote repo is hosted at 
<em>my-new-slice</em> with user <em>ubuntu</em> at the <em>~/pinocchio</em> directory.</p>

<p>On your server's side, all you need is make sure git is installed and the
pinocchio's update hook is enabled on the remote repo.</p>

<h6>
<a name="automated-setup-on-server" class="anchor" href="#automated-setup-on-server"><span class="octicon octicon-link"></span></a>Automated setup on server</h6>

<p>The <code>pinocchio install</code> command can automatically setup Pinocchio for you
on your remote server. Essentially it just checks that git is installed
or installs it for you if it can and then creates a new git bare repo at
the specified directory, copying the <a href="http://github.com/vic/pinocchio">Pinocchio</a> update hook and making it
executable.</p>

<pre lang="shell"><code>$ pinocchio install '~/pinocchio' ubuntu@my-new-slice
</code></pre>

<h6>
<a name="manual-setup-on-server" class="anchor" href="#manual-setup-on-server"><span class="octicon octicon-link"></span></a>Manual setup on server</h6>

<pre lang="shell"><code># install git unless you already have it on your remote server
$ ssh ubuntu@my-new-slice 'sudo apt-get install git'

# create a remote repo for pinocchio and install the update hook
$ cat hooks/pinocchio | ssh ubuntu@my-new-slice 'git init --bare ~/pinocchio &amp;&amp; cat -&gt; ~/pinocchio/hooks/update &amp;&amp; chmod 755 ~/pinocchio/hooks/update'
</code></pre>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<p>You create your provisioning <em>migrations</em> under the <code>migrate/</code> directory.</p>

<pre><code>README
migrate/
        201311051200-install-nginx.sh
        201311051205-install-rvm.sh
etc/
        nginx.conf
</code></pre>

<p><a href="http://github.com/vic/pinocchio">Pinocchio</a> migrations are language agnostic, they can be just shell scripts
as well as python or ruby or whatever your server can execute. The only
requisite is these files <em>need to be executable</em> and exit with <em>zero status</em> when successful. 
I highly recommend to prefix the migration files with a timestamp as Pinocchio will try to run them in natural order.</p>

<p>To aid with timestamps you can use the <code>pinocchio generate</code> command:</p>

<pre lang="shell"><code>$ pinocchio generate install-rvm.sh
  Generated migrate/201311051205-install-rvm.sh
</code></pre>

<p>The etc directory is not even required, you can place all other files
wherever you want, and simply use them inside the migration files. 
In this example the nginx installation shell script could perform something like:
<code>sudo cp ./etc/nginx.conf /opt/nginx</code></p>

<p>After your migrations are ready, you can just push to your remote server and
see pending migrations run.</p>

<pre lang="shell"><code>$ git push
  ...
  remote: Applying 201311051200-install-nginx.sh
  remote: Applying 201311051205-install-rvm.sh
</code></pre>

<p>If all migrations run successfully, the code is updated and next time only
new migrations will be executed.</p>

<h3>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h3>

<p>Feel free to contribute issues, ideas, pull-requests to <a href="http://github.com/vic/pinocchio/issues">http://github.com/vic/pinocchio/issues</a> </p>

<h3>
<a name="testimonies" class="anchor" href="#testimonies"><span class="octicon octicon-link"></span></a>Testimonies</h3>

<blockquote>
<p>Just another puppet who loves using this simple tool to improve their infrastructure and development process:</p>

<p><img src="https://gist.github.com/vic/3494d261c68cb3b591e6/raw/ab4c364f0016fc2f041b86dd842c07515d5dc758/infraestructur.png" alt="Infraestructur"><img src="https://gist.github.com/vic/3494d261c68cb3b591e6/raw/505e8b0cc8c3515810d26750da90cd9df11b0e00/development.png" alt="Development process"></p>
</blockquote>

<h3>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h3>

<p>MIT</p>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/vic">vic</a> can be found on <a href="https://github.com/vic/pinocchio">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
